<odoo>

  <!-- ========================= Kanban ========================= -->
  <record id="view_iso_ticket_kanban" model="ir.ui.view">
    <field name="name">iso.ticket.kanban</field>
    <field name="model">iso.ticket</field>
    <field name="arch" type="xml">
      <kanban default_group_by="status" class="o_kanban_mobile o_kanban_small_column">
        <!-- Declare fields used in template (helps perf) -->
        <field name="name"/>
        <field name="section_id"/>
        <field name="branch_id"/>
        <field name="shift_id"/>
        <field name="date"/>
        <field name="status"/>

        <templates>
          <t t-name="kanban-box">
            <div class="oe_kanban_global_click o_kanban_record">
              <div class="o_kanban_header d-flex justify-content-between align-items-center">
                <strong><field name="name"/></strong>
                <span class="badge badge-pill"><field name="section_id"/></span>
              </div>

              <div class="o_kanban_details mt-2">
                <div><i class="fa fa-calendar"/> <field name="date"/></div>
                <div><i class="fa fa-map-marker"/> <field name="branch_id"/></div>
                <div><i class="fa fa-clock-o"/> <field name="shift_id"/></div>
              </div>

              <div class="o_kanban_footer mt-2">
                <field name="status" widget="badge"/>
              </div>
            </div>
          </t>
        </templates>
      </kanban>
    </field>
  </record>

  <!-- ========================= Tree ========================= -->
  <record id="view_iso_ticket_tree" model="ir.ui.view">
    <field name="name">iso.ticket.tree</field>
    <field name="model">iso.ticket</field>
    <field name="arch" type="xml">
      <tree>
        <field name="name"/>
        <field name="section_id"/>
        <field name="branch_id"/>
        <field name="shift_id"/>
        <field name="date"/>
        <field name="status"/>
      </tree>
    </field>
  </record>

  <!-- ========================= Form (with header + chatter) ========================= -->
  <record id="view_iso_ticket_form" model="ir.ui.view">
    <field name="name">iso.ticket.form</field>
    <field name="model">iso.ticket</field>
    <field name="arch" type="xml">
      <form string="Ticket">
        <header>
          <!-- Use modifiers JSON (Odoo 17) instead of attrs/states -->
          <button name="action_set_pending"
                  type="object"
                  string="Set Pending"
                  class="oe_highlight"
                  modifiers="{'invisible': [['status', '=', 'pending']]}"/>
          <button name="action_set_done"
                  type="object"
                  string="Set Done"
                  class="btn-primary"
                  modifiers="{'invisible': [['status', '=', 'done']]}"/>
          <field name="status" widget="statusbar"/>
        </header>

        <sheet>
          <group>
            <group>
              <field name="name" readonly="1"/>
              <field name="section_id" required="1"/>
              <field name="branch_id" required="1"/>
              <field name="shift_id"/>
              <field name="date" required="1"/>
            </group>
            <group>
              <field name="public_manager_name"/>
              <field name="public_notes"/>
            </group>
          </group>

          <notebook>
            <page string="Lines">
              <field name="line_ids" context="{'default_ticket_id': active_id}">
                <tree editable="bottom">
                  <field name="statement_id" required="1"/>
                  <field name="selection"/>
                  <field name="quantity"/>
                  <field name="notes"/>
                  <field name="manager_name"/>
                </tree>
                <form>
                  <group>
                    <field name="statement_id" required="1"/>
                    <field name="selection"/>
                    <field name="quantity"/>
                    <field name="notes"/>
                    <field name="manager_name"/>
                  </group>
                </form>
              </field>
            </page>
          </notebook>
        </sheet>

        <!-- Chatter -->
        <div class="oe_chatter">
          <field name="message_follower_ids" widget="mail_followers"/>
          <field name="activity_ids" widget="mail_activity"/>
          <field name="message_ids" widget="mail_thread"/>
        </div>
      </form>
    </field>
  </record>

  <!-- ========================= Graph ========================= -->
  <record id="view_iso_ticket_graph" model="ir.ui.view">
    <field name="name">iso.ticket.graph</field>
    <field name="model">iso.ticket</field>
    <field name="arch" type="xml">
      <graph string="Tickets" type="bar">
        <field name="date" type="row"/>
        <field name="id" type="measure"/>
      </graph>
    </field>
  </record>

  <!-- ========================= Pivot ========================= -->
<!--  <record id="view_iso_ticket_pivot" model="ir.ui.view">-->
<!--    <field name="name">iso.ticket.pivot</field>-->
<!--    <field name="model">iso.ticket</field>-->
<!--    <field name="arch" type="xml">-->
<!--      <pivot string="Tickets">-->
<!--        <field name="status" type="col"/>-->
<!--        <field name="section_id" type="row"/>-->
<!--        <field name="date" interval="month" type="row"/>-->
<!--        <field name="id" type="measure"/>-->
<!--      </pivot>-->
<!--    </field>-->
<!--  </record>-->

  <!-- ========================= Search ========================= -->
  <record id="view_iso_ticket_search" model="ir.ui.view">
    <field name="name">iso.ticket.search</field>
    <field name="model">iso.ticket</field>
    <field name="arch" type="xml">
      <search string="Search Tickets">
        <field name="name"/>
        <field name="section_id"/>
        <field name="branch_id"/>
        <field name="shift_id"/>
        <field name="status"/>
        <filter name="pending" string="Pending" domain="[('status','=','pending')]"/>
        <filter name="done" string="Done" domain="[('status','=','done')]"/>
        <filter name="this_month" string="This Month"
                domain="[('date','&gt;=', context_today().replace(day=1)), ('date','&lt;=', (context_today() + relativedelta(months=1, day=1, days=-1)))]"/>
        <group expand="0" string="Group By">
          <filter name="grp_status" string="Status" context="{'group_by':'status'}"/>
          <filter name="grp_section" string="Section" context="{'group_by':'section_id'}"/>
          <filter name="grp_branch" string="Branch" context="{'group_by':'branch_id'}"/>
          <filter name="grp_date" string="Date" context="{'group_by':'date'}"/>
        </group>
      </search>
    </field>
  </record>

  <!-- ========================= Action ========================= -->
  <record id="action_iso_ticket" model="ir.actions.act_window">
    <field name="name">Tickets</field>
    <field name="res_model">iso.ticket</field>
    <field name="view_mode">kanban,tree,form,graph,pivot</field>
    <!-- Set the default filter correctly (matches filter name="pending") -->
    <field name="context">{'search_default_pending': 1}</field>
    <field name="search_view_id" ref="iso_tickets.view_iso_ticket_search"/>
  </record>

</odoo>
