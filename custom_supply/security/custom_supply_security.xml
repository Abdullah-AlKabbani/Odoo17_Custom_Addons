<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">

        <!-- ======================================================
             Record Rules (Dynamic access based on roles & status)
             ====================================================== -->

        <!-- Branch Employee: يمكنه تعديل فقط الطلبات في الحالة InBranch -->
        <record id="rule_branch_employee_edit_inbranch" model="ir.rule">
            <field name="name">Branch Employee: Edit InBranch Requests Only</field>
            <field name="model_id" ref="custom_supply.model_custom_supply_supply_request"/>
            <field name="domain_force">[('status','=','InBranch')]</field>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="groups" eval="[(4, ref('custom_supply.group_branch_employee'))]"/>
        </record>

        <!-- Supply Manager: يرى الطلبات في حالاتها المختلفة -->
        <record id="rule_supply_manager_access_supply_inwarehouse" model="ir.rule">
            <field name="name">Supply Manager: Access Supply and InWarehouse</field>
            <field name="model_id" ref="custom_supply.model_custom_supply_supply_request"/>
            <field name="domain_force">[('status','in',['Supply','InWarehouse','InBranch','Done'])]</field>
            <field name="groups" eval="[(4, ref('custom_supply.group_supply_manager'))]"/>
        </record>

        <!-- Warehouse Employee: تعديل خطوط الطلبات المرتبطة بالطلبات InWarehouse -->
        <record id="rule_warehouse_employee_lines_inwarehouse" model="ir.rule">
            <field name="name">Warehouse Employee: Edit Lines of InWarehouse Requests Only</field>
            <field name="model_id" ref="custom_supply.model_custom_supply_supply_request_line"/>
            <field name="domain_force">[('request_id.status','=','InWarehouse')]</field>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
            <field name="groups" eval="[(4, ref('custom_supply.group_warehouse_employee'))]"/>
        </record>

        <!-- Branch Employee: يرى منتجات فرعه فقط -->
        <record id="rule_branch_employee_branch_products" model="ir.rule">
            <field name="name">Branch Employee: See Own Branch Products Only</field>
            <field name="model_id" ref="custom_supply.model_custom_supply_branch_product"/>
            <field name="domain_force">[('branch_id','=',user.branch_id.id)]</field>
            <field name="groups" eval="[(4, ref('custom_supply.group_branch_employee'))]"/>
        </record>

        <!-- إضافات من أجل قوائم الباك إيند -->
        <record id="rule_branch_employee_own_branch_requests" model="ir.rule">
            <field name="name">Branch Employee: Own Branch Requests Only (read/write)</field>
            <field name="model_id" ref="custom_supply.model_custom_supply_supply_request"/>
            <field name="domain_force">[('branch_id','=', user.branch_id.id)]</field>
            <field name="groups" eval="[(4, ref('custom_supply.group_branch_employee'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
        </record>

        <record id="rule_supply_manager_supply_only" model="ir.rule">
            <field name="name">Supply Manager: Only Supply status</field>
            <field name="model_id" ref="custom_supply.model_custom_supply_supply_request"/>
            <field name="domain_force">[('status','=','Supply')]</field>
            <field name="groups" eval="[(4, ref('custom_supply.group_supply_manager'))]"/>
        </record>

        <record id="rule_warehouse_employee_inwarehouse" model="ir.rule">
            <field name="name">Warehouse Employee: Only InWarehouse</field>
            <field name="model_id" ref="custom_supply.model_custom_supply_supply_request"/>
            <field name="domain_force">[('status','in',['InWarehouse','Done'])]</field>
            <field name="groups" eval="[(4, ref('custom_supply.group_warehouse_employee'))]"/>
        </record>

        <record id="rule_high_manager_tracking" model="ir.rule">
            <field name="name">High Manager Read All Supply Requests</field>
            <field name="model_id" ref="custom_supply.model_custom_supply_supply_request"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('custom_supply.group_high_manager'))]"/>
        </record>

        <record id="rule_supply_request_branch_employee" model="ir.rule">
            <field name="name">Supply Requests - Branch Employee (only InBranch of their branch)</field>
            <field name="model_id" ref="custom_supply.model_custom_supply_supply_request"/>
            <field name="domain_force">[('status','=','InBranch'),('branch_id','=',user.branch_id.id)]</field>
            <field name="groups" eval="[(4, ref('custom_supply.group_branch_employee'))]"/>
        </record>

        <record id="rule_supply_request_supply_manager" model="ir.rule">
            <field name="name">Supply Requests - Supply Manager (only Supply)</field>
            <field name="model_id" ref="custom_supply.model_custom_supply_supply_request"/>
            <field name="domain_force">[('status','=','Supply')]</field>
            <field name="groups" eval="[(4, ref('custom_supply.group_supply_manager'))]"/>
        </record>

        <record id="rule_supply_request_warehouse" model="ir.rule">
            <field name="name">Supply Requests - Warehouse Employee (only InWarehouse)</field>
            <field name="model_id" ref="custom_supply.model_custom_supply_supply_request"/>
            <field name="domain_force">[('status','=','InWarehouse')]</field>
            <field name="groups" eval="[(4, ref('custom_supply.group_warehouse_employee'))]"/>
        </record>

        <record id="rule_warehouse_employee_lines_done" model="ir.rule">
            <field name="name">Warehouse Employee: Read Lines of Done Requests</field>
            <field name="model_id" ref="custom_supply.model_custom_supply_supply_request_line"/>
            <field name="domain_force">[('request_id.status','=','Done')]</field>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="0"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
            <field name="groups" eval="[(4, ref('custom_supply.group_warehouse_employee'))]"/>
        </record>

    </data>
</odoo>
