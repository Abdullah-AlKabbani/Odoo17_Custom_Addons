<odoo>
  <template id="template_helpdesk_visit_form" name="Help Desk Visit Form">
    <t t-call="website.layout">
      <div class="container my-5">
        <h1>Help Desk Visits Report</h1>

        <t t-if="error">
          <div class="alert alert-danger" role="alert">
            <t t-esc="error"/>
          </div>
        </t>

        <form t-attf-action="/helpdesk/visit/report/submit" method="post" class="mt-4 o_website_form">
           <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

          <div class="mb-3">
            <label class="form-label">Name</label>
            <input name="name" type="text" class="form-control" required="required"/>
          </div>

          <h4 class="mt-4">Branch Information</h4>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Branch</label>
              <select name="branch_id" class="form-select" required="required">
                <option value="">Select branch...</option>
                <t t-foreach="branches" t-as="b">
                  <option t-att-value="b.id"><t t-esc="b.name"/></option>
                </t>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Responsible Person</label>
              <input name="branch_responsible" type="text" class="form-control"/>
            </div>
          </div>

          <h4 class="mt-4">Visit Status</h4>
          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label">Visit Type</label>
              <select name="visit_type_id" class="form-select" required="required">
                <option value="">Select type...</option>
                <t t-foreach="types" t-as="t">
                  <option t-att-value="t.id"><t t-esc="t.name"/></option>
                </t>
              </select>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Date &amp; Time</label>
              <input name="visit_datetime" type="datetime-local" class="form-control" required="required"/>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Urgent Visit</label>
              <select name="is_urgent" class="form-select">
                <option value="no">No</option>
                <option value="yes">Yes</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Method of Ticket Request</label>
              <select name="request_method_id" class="form-select" required="required">
                <option value="">Select method...</option>
                <t t-foreach="methods" t-as="m">
                  <option t-att-value="m.id"><t t-esc="m.name"/></option>
                </t>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Ticket Number</label>
              <input type="text" class="form-control" value="(auto)" disabled="disabled"/>
            </div>
          </div>

          <h4 class="mt-4">Detailed Work and Notes</h4>
          <div class="mb-3">
            <textarea name="details" class="form-control" rows="4"></textarea>
          </div>

          <h4 class="mt-4">Services</h4>
          <h5>POS Device</h5>
          <div class="row">
            <div class="col-md-3 mb-3">
              <label class="form-label">Overall Status</label>
              <select name="pos_overall_status" class="form-select">
                <option value="">--</option>
                <option value="working">Working</option>
                <option value="not_working">Not Working</option>
              </select>
            </div>
            <div class="col-md-3 mb-3">
              <label class="form-label">HDD Usage (%)</label>
              <input name="pos_hdd_usage" type="number" step="0.01" min="0" max="100" class="form-control"/>
            </div>
            <div class="col-md-3 mb-3">
              <label class="form-label">CPU Usage (%)</label>
              <input name="pos_cpu_usage" type="number" step="0.01" min="0" max="100" class="form-control"/>
            </div>
            <div class="col-md-3 mb-3">
              <label class="form-label">OS Status</label>
              <select name="pos_os_status" class="form-select">
                <option value="">--</option>
                <option value="activated">Activated</option>
                <option value="not_activated">Not Activated</option>
              </select>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">RAM</label>
            <input name="pos_ram" type="text" class="form-control" placeholder="e.g., 8 GB"/>
          </div>

          <h5 class="mt-3">Other Devices</h5>
          <div id="devices-wrapper">
            <div class="row g-2 align-items-end mb-2 device-row">
              <div class="col-md-5">
                <label class="form-label">Device</label>
                <select name="device_id[]" class="form-select">
                  <option value="">--</option>
                  <t t-foreach="devices" t-as="d">
                    <option t-att-value="d.id"><t t-esc="d.name"/></option>
                  </t>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Overall Status</label>
                <select name="device_status[]" class="form-select">
                  <option value="working">Working</option>
                  <option value="not_working">Not Working</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Notes</label>
                <input name="device_note[]" type="text" class="form-control"/>
              </div>
            </div>
          </div>
          <button type="button" class="btn btn-secondary mb-3" t-attf-onclick="
            var wrap=document.getElementById('devices-wrapper');
            var row=wrap.querySelector('.device-row').cloneNode(true);
            row.querySelectorAll('input').forEach(i=>i.value='');
            row.querySelectorAll('select').forEach(s=>s.selectedIndex=0);
            wrap.appendChild(row);
          ">+ Add Device</button>

          <h4 class="mt-4">Backup System</h4>
          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label">Status of Last Backup</label>
              <input name="backup_status" type="text" class="form-control"/>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Date</label>
              <input name="backup_date" type="date" class="form-control"/>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Notes</label>
              <input name="backup_notes" type="text" class="form-control"/>
            </div>
          </div>

          <div class="mt-4">
            <button type="submit" class="btn btn-primary">Submit Report</button>
          </div>
        </form>
      </div>
    </t>
  </template>

  <template id="template_helpdesk_visit_thanks" name="Help Desk Visit Thanks">
    <t t-call="website.layout">
      <div class="container my-5">
        <h2>Thank you!</h2>
        <p>Your Help Desk Visit Report has been submitted.</p>
        <t t-if="tn">
          <p>Your ticket number: <strong><t t-esc="tn"/></strong></p>
        </t>
        <a href="/helpdesk/visit/report" class="btn btn-secondary mt-3">Submit Another</a>
      </div>
    </t>
  </template>
</odoo>




